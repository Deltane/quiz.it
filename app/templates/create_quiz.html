<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="../static/css/create_quiz.css">
</head>
<body>
<div class="container">
    <h2>Create a New Quiz</h2>
    <form id="quiz-setup-form">
        <div class="form-group">
            <label for="quiz-name">Quiz Name</label>
            <input type="text" class="form-control" id="quiz-name" name="quiz-name" required>
        </div>
        <div class="form-group">
            <label for="upload-file">Upload File</label>
            <input type="file" class="form-control" id="upload-file" name="upload-file" accept=".pdf,.doc,.docx,.txt">
        </div>
        <div class="form-group">
            <label for="ai-prompt">Or ask AI</label>
            <textarea class="form-control" id="ai-prompt" name="ai-prompt" rows="3"></textarea>
        </div>
        <div class="form-group">
            <label for="timer">Timer (minutes)</label>
            <input type="number" class="form-control" id="timer" name="timer" value="0" min="0">
        </div>
        <div class="form-group">
            <label for="quiz-type">Quiz Type</label>
            <select class="form-control" id="quiz-type" name="quiz-type">
                <option>Multiple Choice</option>
                <option>Short Answer</option>
                <option>Fill in the Blank</option>
            </select>
        </div>
        <div class="form-group">
            <label for="question-count">Question Count</label>
            <input type="number" class="form-control" id="question-count" name="question-count" min="1" max="50" required>
        </div>
        <div class="form-group">
            <label>Privacy</label>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="privacy" id="public" value="public" checked>
                <label class="form-check-label" for="public">Public</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="privacy" id="private" value="private">
                <label class="form-check-label" for="private">Private</label>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Generate Quiz</button>
    </form>

    <hr>
    <h3>Generated Quiz:</h3>
    <pre id="quiz-result" style="background-color: #f0f0f0; padding: 10px; border-radius: 8px;"></pre>
</div>

<script>
    $(document).ready(function () {
        // Disable AI prompt when file is uploaded
        $('#upload-file').change(function () {
            if ($(this).val()) {
                $('#ai-prompt').prop('disabled', true);
            } else {
                $('#ai-prompt').prop('disabled', false);
            }
        });
    
        // Disable file upload when AI prompt is typed
        $('#ai-prompt').on('input', function () {
            if ($(this).val()) {
                $('#upload-file').prop('disabled', true);
            } else {
                $('#upload-file').prop('disabled', false);
            }
        });
    
        // Submit the form via AJAX
        $('#quiz-setup-form').on('submit', function (e) {
            e.preventDefault();
    
            const formData = new FormData(this);
            $('#quiz-result').text('Generating quiz...');
    
            fetch('/generate_quiz', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.quiz) {
                    const quizContainer = $('#quiz-result');
                    quizContainer.empty(); // Clear previous content
    
                    // Render the quiz as a form
                    const quizForm = $('<form id="quiz-form"></form>');
                    data.quiz.forEach((question, index) => {
                        const questionDiv = $('<div class="question"></div>');
                        questionDiv.append(`<p><strong>Q${index + 1}:</strong> ${question.question}</p>`);
    
                        // Add options as radio buttons
                        question.options.forEach((option, optionIndex) => {
                            const optionId = `q${index}_option${optionIndex}`;
                            questionDiv.append(`
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="q${index}" id="${optionId}" value="${option}">
                                    <label class="form-check-label" for="${optionId}">${option}</label>
                                </div>
                            `);
                        });
    
                        quizForm.append(questionDiv);
                    });
    
                    // Add a submit button for the quiz
                    quizForm.append('<button type="submit" class="btn btn-success">Submit Quiz</button>');
    
                    // Append the form to the quiz container
                    quizContainer.append(quizForm);
    
                    // Handle quiz submission
                    quizForm.on('submit', function (e) {
                        e.preventDefault();
                        const answers = $(this).serializeArray();
                        console.log('User answers:', answers); // Debug: Log user answers
    
                        // Send answers to the server for scoring
                        fetch('/submit_quiz', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ answers, quiz: data.quiz }) // Send answers and quiz data
                        })
                        .then(response => response.json())
                        .then(scoreData => {
                            alert(`Your score: ${scoreData.score}/${data.quiz.length}`);
                        })
                        .catch(err => {
                            alert('Error submitting quiz: ' + err.message);
                        });
                    });
                } else {
                    $('#quiz-result').text(data.error || 'Something went wrong.');
                }
            })
            .catch(err => {
                $('#quiz-result').text('Error: ' + err.message);
            });
        });
    });
    </script>